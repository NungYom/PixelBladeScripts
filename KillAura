-- UI SETUP
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HRP = Character:WaitForChild("HumanoidRootPart")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AutoFarmUI"
ScreenGui.Parent = game:GetService("CoreGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 180)
mainFrame.Position = UDim2.new(0, 20, 0, 200)
mainFrame.BackgroundTransparency = 0.3
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Parent = ScreenGui

local function createButton(text, order, callback)
	local button = Instance.new("TextButton")
	button.Size = UDim2.new(1, -20, 0, 30)
	button.Position = UDim2.new(0, 10, 0, 10 + (order - 1) * 40)
	button.Text = text
	button.TextColor3 = Color3.new(1, 1, 1)
	button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	button.Font = Enum.Font.SourceSansBold
	button.TextSize = 18
	button.MouseButton1Click:Connect(callback)
	button.Parent = mainFrame
end

-- VARIABLES
local autoFarm4 = false
local startPosition = nil
local farmDestination = nil
local collectDuration = 7
local shakeDuration = 10

-- UTILS
local function getEquippedPan()
	return Character:FindFirstChild("Worldshaker")
end

-- REMOTE FUNCTIONS
local function fastCollect(duration)
	local pan = getEquippedPan()
	if not (pan and pan.Scripts and pan.Scripts:FindFirstChild("Collect")) then return end
	local collectFunc = pan.Scripts.Collect
	local startTime = tick()

	spawn(function()
		while tick() - startTime < duration do
			pcall(function() collectFunc:InvokeServer() end)
			pcall(function() collectFunc:InvokeServer(1) end)
			task.wait(0)
		end
	end)
end

local function fastShake(duration)
	local pan = getEquippedPan()
	if not (pan and pan.Scripts and pan.Scripts:FindFirstChild("Shake")) then return end
	local shakeFunc = pan.Scripts.Shake
	local startTime = tick()

	spawn(function()
		while tick() - startTime < duration do
			pcall(function() shakeFunc:FireServer() end)
			task.wait(0)
		end
	end)
end

-- GUI BUTTON CALLBACKS
createButton("Start", 1, function()
	startPosition = HRP.Position
	local part = workspace:FindFirstChild("Dig Here")
	if part then
		farmDestination = part.Position
		autoFarm4 = true
	end
end)

createButton("Stop", 2, function()
	autoFarm4 = false
end)

createButton("Enchant", 3, function()
	local args = {
		Instance.new("Tool", nil)
	}
	ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Crafting"):WaitForChild("Enchant"):InvokeServer(unpack(args))
end)

-- AUTO FARM LOOP
spawn(function()
	while true do
		if autoFarm4 and farmDestination and startPosition and HRP and Character then
			pcall(function()
				HRP.CFrame = CFrame.new(farmDestination)
				wait(0.5)

				fastCollect(collectDuration)
				task.wait(collectDuration + 0.1)

				HRP.CFrame = CFrame.new(startPosition)
				wait(0.2)

				fastShake(shakeDuration)
				task.wait(shakeDuration + 0.1)
			end)
		end
		wait(1)
	end
end)
