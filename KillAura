repeat task.wait() until game:IsLoaded()

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer or Players:GetPlayers()[1]
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HRP = Character:WaitForChild("HumanoidRootPart")
local Checkpoints = workspace:WaitForChild("Checkpoints")

local tweenTime = 2
local waitTime = 0.5

-- GUI
local gui = Instance.new("ScreenGui", game.CoreGui)
local status = Instance.new("TextLabel", gui)
status.Size = UDim2.new(0, 300, 0, 40)
status.Position = UDim2.new(1, -310, 0, 10)
status.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
status.BackgroundTransparency = 0.3
status.TextColor3 = Color3.new(1, 1, 1)
status.TextScaled = true
status.Text = "กำลังโหลด..."

-- Functions
local function getOthers()
	local n = 0
	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= LocalPlayer then n += 1 end
	end
	return n
end

local function tweenToPosition(pos)
	local tweenInfo = TweenInfo.new(tweenTime, Enum.EasingStyle.Linear)
	local tween = TweenService:Create(HRP, tweenInfo, {CFrame = CFrame.new(pos)})
	tween:Play()
	tween.Completed:Wait()
	task.wait(waitTime)
end

local function tweenToPart(name)
	local part = Checkpoints:FindFirstChild(tostring(name))
	if part then
		tweenToPosition(part.Position + Vector3.new(0, 3, 0))
	end
end

-- Steps
local steps = {}

table.insert(steps, function() tweenToPosition(Vector3.new(448,1470,5145)) end)
table.insert(steps, function() tweenToPart(1) end)
table.insert(steps, function() tweenToPosition(Vector3.new(389,1543,5397)) end)
table.insert(steps, function() tweenToPart(2) end)
table.insert(steps, function() tweenToPosition(Vector3.new(370,1600,6270)) end)

for i = 3, 4 do table.insert(steps, function() tweenToPart(i) end) end
table.insert(steps, function() tweenToPosition(Vector3.new(69,1635,7034)) end)
for i = 5, 11 do table.insert(steps, function() tweenToPart(i) end) end

table.insert(steps, function() tweenToPosition(Vector3.new(217,1915,9782)) end)
for i = 12, 17 do table.insert(steps, function() tweenToPart(i) end) end
table.insert(steps, function() tweenToPosition(Vector3.new(-76,2232,11084)) end)
for i = 18, 30 do table.insert(steps, function() tweenToPart(i) end) end
table.insert(steps, function() tweenToPosition(Vector3.new(101,2630,12545)) end)
table.insert(steps, function() tweenToPosition(Vector3.new(-79,2845,13234)) end)
table.insert(steps, function() tweenToPosition(Vector3.new(-42,2865,13354)) end)
table.insert(steps, function() tweenToPosition(Vector3.new(41,2875,13611)) end)
table.insert(steps, function() tweenToPosition(Vector3.new(95,2879,13668)) end)
table.insert(steps, function()
	local args = {"reset_request"}
	game:GetService("ReplicatedStorage"):WaitForChild("ResetBasecampEvent"):FireServer(unpack(args))
end)

-- Main loop
task.wait(3)
status.Text = "พร้อมทำงาน"

while true do
	local others = getOthers()
	if others > 0 then
		status.Text = "มีผู้เล่นอื่นอีก " .. tostring(others) .. " คน กำลังรอ..."
		repeat
			task.wait(1)
			others = getOthers()
		until others == 0
		status.Text = "ไม่มีผู้เล่นอื่น เหลือคุณคนเดียว เริ่มทำงาน"
	end

	for i, step in ipairs(steps) do
		status.Text = "กำลังทำขั้นตอนที่ " .. i .. "/" .. #steps
		step()
	end
end
